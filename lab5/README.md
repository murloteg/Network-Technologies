# SOCKS-proxy

### Необходимо реализовать прокси-сервер, соответствующий стандарту SOCKS версии 5.

<span style="font-size: 16px">
    <code>Входные параметры:</code>
    <ul>
        <li>
            В параметрах программе передаётся только порт, на котором прокси будет ждать входящих подключений от клиентов.
        </li>
    </ul>
    <code>Требования к реализации:</code>
    <ul>
        <li>
            Из трёх доступных в протоколе команд, обязательной является только реализация команды 1 (establish a TCP/IP stream connection).
        </li>
        <li>
            Поддержку аутентификации и IPv6-адресов реализовывать не требуется.
        </li>
        <li>
            Для реализации прокси использовать неблокирующиеся сокеты, работая с ними в рамках одного треда. Дополнительные треды использовать не допускается.<br>
            Соответственно, никаких блокирующихся вызовов (кроме вызова селектора) не допускается.
        </li>
        <li>
            Прокси не должна делать предположений о том, какой протокол уровня приложений будет использоваться внутри перенаправляемого TCP-соединения.<br>
            В частности, должна поддерживаться передача данных одновременно в обе стороны, а соединения должны закрываться аккуратно (только после того, как они больше не нужны).
        </li>
        <li>
            В приложении не должно быть холостых циклов ни в каких ситуациях.<br>
            Другими словами, не должно быть возможно состояние программы, при котором неоднократно выполняется тело цикла, которое не делает ни одной фактической передачи данных за итерацию.
        </li>
        <li>
            Не допускается неограниченное расходование памяти для обслуживания одного клиента.
        </li>
        <li>
            Производительность работы через прокси не должна быть заметно хуже, чем без прокси. Для отслеживания корректности и скорости работы можно глядеть в Developer tools браузера на вкладку Network.
        </li>
        <li>
            Прокси должен поддерживать резолвинг доменных имён (значение 0x03 в поле address). Резолвинг тоже должен быть неблокирующимся. Для этого предлагается использовать следующий подход:<br>
                - На старте программы создать новый UDP-сокет и добавить его в селектор на чтение<br>
                - Когда необходимо отрезолвить доменное имя, отправлять через этот сокет DNS-запрос A-записи на адрес рекурсивного DNS-резолвера<br>
                - В обработчике чтения из сокета обрабатывать случай, когда получен ответ на DNS-запрос, и продолжать работу с полученным адресом
        </li>
        <li>
            Для получения <a href="https://stackoverflow.com/questions/21923682/getting-the-address-of-a-dns-server-programmatically-in-java/51844866#51844866">адреса рекурсивного резолвера</a>, а также для <a href="https://javadoc.io/doc/dnsjava/dnsjava/latest/org/xbill/DNS/Message.html">формирования и парсинга DNS-сообщений на Java</a> предлагается использовать библиотеку <a href="https://github.com/dnsjava/dnsjava">dnsjava</a> (для других языков найдите сами).<br>
        </li>
    </ul>
    <code>Прочее:</code>
    <ul>
        <li>
            Для тестирования можно настроить любой Web-браузер на использование вашего прокси, и посещать любые веб-сайты, богатые контентом.
        </li>
        <li>
            <a href="https://en.wikipedia.org/wiki/SOCKS">Описание протокола на английской Википедии</a>
        </li>
        <li>
            <a href="https://www.ietf.org/rfc/rfc1928.txt">SOCKS 5 RFC</a>
        </li>
    </ul>
</span>
